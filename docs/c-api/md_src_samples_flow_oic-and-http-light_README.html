<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Soletta™ Framework: Sample: OIC and HTTP light-server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Soletta™ Framework
   </div>
   <div id="projectbrief">
   Framework for making IoT devices<br /><br />
   <small>
   <a href="http://solettaproject.github.io/docs/">Full online documentation</a> | 
   <a href="index.html">C API Index</a>
   </small><br />
   </div>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Sample: OIC and HTTP light-server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This sample provides a light-server that uses both OIC and HTTP to communicate with controllers, persisting data to disk so it can be restored on restart.</p>
<p>It also provides two controllers, one via HTTP and the other via OIC. The OIC is very simple, since the resource is exposed as a single node with multiple ports and the protocol supports observing, thus no polling is required. HTTP uses individual nodes per sub-resource (power and state) and needs to poll in a timely manner to synchronize the controller status with the light-server. However both controllers share the same logic to read input and quit the application, so it is isolated in its own <code>controller.fbp</code>.</p>
<p>The input and output are declared in <code>sol-flow.json</code> and the board variants. By default it will read from keyboard and print to console, in supported boards it will use GPIO and PWM to act on hardware.</p>
<h2>Concepts</h2>
<ul>
<li>running multiple network servers in the same application;</li>
<li>splitting functionality into different FBP files;</li>
<li>using per-board configuration of nodes, with reasonable fallback;</li>
<li>how to use the integer accumulator;</li>
<li>how to convert between packet types;</li>
<li>synchronization using cross-link between node types;</li>
<li>receiving command from command line;</li>
<li>quitting the application;</li>
<li>using the intrinsic ERROR port;</li>
<li>persistence to file storage;</li>
<li>HTTP server and client;</li>
<li>OIC server and client.</li>
</ul>
<h2>Running</h2>
<p>To test the setup open 3 console terminals:</p>
<h3>Server Terminal</h3>
<p>```sh user/host$ export SOL_MACHINE_ID="580a3d6a9d194a23b90a24573558d2f4" user/host$ sol-fbp-runner oic-and-http-light-server.fbp</p>
<p>OIC device-id: 580a3d6a9d194a23b90a24573558d2f4 (string) note: http-light-server running on port 8002, paths: /state and /power (string) state: true (boolean) power: 100 (integer range)</p>
<p>```</p>
<p>Defining the <code>SOL_MACHINE_ID</code> is optional, but recommended to keep execution consistent. You'll need the machine ID since it is used to create the OIC Device ID, however this is printted to the console as displayed above.</p>
<p>The server will save its state, thus it can be stopped (with <code>^C</code> or kill) and restarted.</p>
<h3>HTTP Controller Terminal</h3>
<p>```sh user/host$ export no_proxy="localhost,$no_proxy" user/host$ sol-fbp-runner http-controller.fbp <a href="http://localhost:8002">http://localhost:8002</a> Hint: Press 'a' to change state, 'j' to increase power and 'k' to decrease it, 'q' to quit. (string) Server power level is: 0 (integer range) Power value changed: 0 (integer range) Server state is: true (boolean) State changed: true (boolean) Server power level is: 0 (integer range) Server state is: true (boolean) State changed: false (boolean) Server power level is: 0 (integer range) Server state is: false (boolean) Power value changed: 1 (integer range) Server power level is: 1 (integer range) Server state is: false (boolean) ```</p>
<p>Defining <code>no_proxy</code> is optional, but recommended to avoid incorrect proxy configurations.</p>
<p>Upon start, the controller will query the server using HTTP <code>GET</code> requests and will update its internal state.</p>
<p>The state can then be changed using the keyboard:</p>
<ul>
<li><code>a</code> (keycode 97): change state</li>
<li><code>j</code> (keycode 106): increase power level</li>
<li><code>k</code> (keycode 107): decrease power level</li>
<li><code>q</code> (keycode 113): quit the application</li>
</ul>
<p>Once the state is changed, it will execute HTTP <code>POST</code> requests to the server, which will show the updated values.</p>
<h3>OIC Controller Terminal</h3>
<p>```sh user/host$ sol-fbp-runner oic-controller.fbp 580a3d6a9d194a23b90a24573558d2f4 Hint: Press 'a' to change state, 'j' to increase power and 'k' to decrease it, 'q' to quit. (string) Server state is: true (boolean) Server power level is: 1 (integer range) Power value changed: 1 (integer range) State changed: true (boolean) State changed: false (boolean) Power value changed: 2 (integer range)</p>
<p>```</p>
<p>Upon start, the controller will start a scan and if the given device ID is found, it will be observed.</p>
<p>The state can then be changed using the keyboard:</p>
<ul>
<li><code>a</code> (keycode 97): change state</li>
<li><code>j</code> (keycode 106): increase power level</li>
<li><code>k</code> (keycode 107): decrease power level</li>
<li><code>q</code> (keycode 113): quit the application</li>
</ul>
<p>Once the state is changed, it will execute CoAP <code>POST</code> requests to the server, which will show the updated values.</p>
<h3>TODO</h3>
<ul>
<li>create a second http-controller that reads the URL from form/string + grove/lcd-string and GPIO, and persist. Press and hold one button to reconfigure URL;</li>
<li>create a second oic-controller that SCAN the DEVICE-ID and uses form/selector + grove/lcd-string to select, and persist. Press and hold one button to reconfigure DEVICE-ID;</li>
<li>create a tutorial covering incremental steps on how to do the whole sample (could be in a sub-directory of it or in doc/tutorial), how to compile and run for multiple boards and OS. </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<a href="http://solettaproject.github.io/docs/">Full online documentation</a> | 
<a href="index.html">C API Index</a>
</small></address>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
