<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Soletta™ Framework: /src/samples/common/uart.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Soletta™ Framework
   </div>
   <div id="projectbrief">
   Framework for making IoT devices<br /><br />
   <small>
   <a href="http://solettaproject.github.io/docs/">Full online documentation</a> | 
   <a href="index.html">C API Index</a>
   </small><br />
   </div>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/src/samples/common/uart.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This file is part of the Soletta (TM) Project</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2015 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> * You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> * limitations under the License.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sol-mainloop_8h.html">sol-mainloop.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sol-uart_8h.html">sol-uart.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sol-util_8h.html">sol-util.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sol-str-slice_8h.html">sol-str-slice.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="soletta_8h.html">soletta.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define FEED_SIZE (512)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_PACKETS (100)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="group__UART.html#ga810a1c2f354acba92a33ee97806ad3d1">sol_uart</a> *<a name="a0"></a><a class="code" href="uart_8c.html#a9a72b10cfa6ae68070956e2f3478dc22">producer</a>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="group__UART.html#ga810a1c2f354acba92a33ee97806ad3d1">sol_uart</a> *<a name="a1"></a><a class="code" href="uart_8c.html#a69f5aa89cdbb8f95230645b8036d609c">consumer</a>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="group__Mainloop.html#ga40dddc147a0d6370aeb8219a90b56596">sol_timeout</a> *<a name="a2"></a><a class="code" href="uart_8c.html#a2fb0f9e777be7400a884f58fb79ae0ab">producer_timeout</a>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a3"></a><a class="code" href="structsol__blob.html">sol_blob</a> *<a name="a4"></a><a class="code" href="uart_8c.html#ac8039a169abc660ac9616fd0df720f68">pending_blob</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> <a name="a5"></a><a class="code" href="uart_8c.html#af9f6c5e151a851d960a38b4d4b1cb432">producer_make_data</a>(<span class="keywordtype">void</span> *data);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> <a name="a6"></a><a class="code" href="uart_8c.html#ac7f3be202700792259fedf833dcf695a">send_blob</a>(<span class="keyword">struct</span> <a class="code" href="structsol__blob.html">sol_blob</a> *blob);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="a7"></a><a class="code" href="uart_8c.html#a8694ec865bfd7b8d243ca28de0957684">producer_data_written</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="group__UART.html#ga810a1c2f354acba92a33ee97806ad3d1">sol_uart</a> *uart, <span class="keyword">struct</span> <a class="code" href="structsol__blob.html">sol_blob</a> *blob, <span class="keywordtype">int</span> status)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a8"></a><a class="code" href="structsol__str__slice.html">sol_str_slice</a> slice;</div>
<div class="line"></div>
<div class="line">    slice = <a name="a9"></a><a class="code" href="group__Str__Slice.html#gafc4606ede8c6c6bf264e71b08f0338e7">sol_str_slice_from_blob</a>(blob);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Could not write the UUID %.*s - Reason: %s\n&quot;</span>, <a name="a10"></a><a class="code" href="group__Str__Slice.html#ga10c9d829c4d0c50467106a14190d7611">SOL_STR_SLICE_PRINT</a>(slice),</div>
<div class="line">            <a name="a11"></a><a class="code" href="group__Utils.html#gab584188ab3f38605dab8b04aaa85913d">sol_util_strerrora</a>(-status));</div>
<div class="line">        <a name="a12"></a><a class="code" href="group__Mainloop.html#ga56c31320e4348c91a719039b5a22dd25">sol_quit</a>();</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Producer: UUID %.*s written\n&quot;</span>, <a class="code" href="group__Str__Slice.html#ga10c9d829c4d0c50467106a14190d7611">SOL_STR_SLICE_PRINT</a>(slice));</div>
<div class="line">        <span class="keywordflow">if</span> (pending_blob) { <span class="comment">//If we have a pending blob now it&#39;s the time to try to send it!</span></div>
<div class="line">            <span class="keywordflow">if</span> (!<a class="code" href="uart_8c.html#ac7f3be202700792259fedf833dcf695a">send_blob</a>(pending_blob)) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Could not send the pending blob!\n&quot;</span>);</div>
<div class="line">                <a class="code" href="group__Mainloop.html#ga56c31320e4348c91a719039b5a22dd25">sol_quit</a>();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a class="code" href="uart_8c.html#ac7f3be202700792259fedf833dcf695a">send_blob</a>(<span class="keyword">struct</span> <a class="code" href="structsol__blob.html">sol_blob</a> *blob)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line">    <span class="keywordtype">bool</span> r = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Actually write the blob into UART bus</span></div>
<div class="line">    err = <a name="a13"></a><a class="code" href="group__UART.html#ga6ef429c957d5aacaaa9fdb61ba4e0b7b">sol_uart_feed</a>(<a class="code" href="uart_8c.html#a9a72b10cfa6ae68070956e2f3478dc22">producer</a>, blob);</div>
<div class="line">    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line">        <span class="comment">//Oh no, there&#39;s no more space left.</span></div>
<div class="line">        <span class="keywordflow">if</span> (err == -ENOSPC) {</div>
<div class="line">            pending_blob = blob;</div>
<div class="line">            printf(<span class="stringliteral">&quot;No space left in the tx buffer - saving blob for later. Data: %.*s\n&quot;</span>,</div>
<div class="line">                <a class="code" href="group__Str__Slice.html#ga10c9d829c4d0c50467106a14190d7611">SOL_STR_SLICE_PRINT</a>(<a class="code" href="group__Str__Slice.html#gafc4606ede8c6c6bf264e71b08f0338e7">sol_str_slice_from_blob</a>(pending_blob)));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Could not not perform an UART write - Reason: %s\n&quot;</span>,</div>
<div class="line">                <a class="code" href="group__Utils.html#gab584188ab3f38605dab8b04aaa85913d">sol_util_strerrora</a>(-r));</div>
<div class="line">            r = <span class="keyword">false</span>;</div>
<div class="line">            <a name="a14"></a><a class="code" href="group__Types.html#gaaf14a0023ae6a06a7e9960e5b622a2ad">sol_blob_unref</a>(blob);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code" href="group__Types.html#gaaf14a0023ae6a06a7e9960e5b622a2ad">sol_blob_unref</a>(blob);</div>
<div class="line">        <span class="keywordflow">if</span> (blob == pending_blob)</div>
<div class="line">            pending_blob = NULL; <span class="comment">//Flag that data production can start once again!</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> r;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a class="code" href="uart_8c.html#af9f6c5e151a851d960a38b4d4b1cb432">producer_make_data</a>(<span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span> *v;</div>
<div class="line">    <span class="keywordtype">size_t</span> size;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsol__blob.html">sol_blob</a> *blob;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a15"></a><a class="code" href="structsol__buffer.html">sol_buffer</a> buf = <a name="a16"></a><a class="code" href="group__Buffer.html#gaa713288ab086f3fcd98c51870a571a52">SOL_BUFFER_INIT_EMPTY</a>;</div>
<div class="line">    <span class="keyword">static</span> uint16_t packets_created = 0;</div>
<div class="line">    <span class="keywordtype">bool</span> keep_running = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordtype">int</span> r;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Stop the production until the pendind blob is sent</span></div>
<div class="line">    <span class="keywordflow">if</span> (pending_blob) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Waiting for blob data: %.*s to be transferred.\n&quot;</span>,</div>
<div class="line">            <a class="code" href="group__Str__Slice.html#ga10c9d829c4d0c50467106a14190d7611">SOL_STR_SLICE_PRINT</a>(<a class="code" href="group__Str__Slice.html#gafc4606ede8c6c6bf264e71b08f0338e7">sol_str_slice_from_blob</a>(pending_blob)));</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    packets_created++;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Generate data</span></div>
<div class="line">    <span class="keywordflow">if</span> (packets_created != <a name="a17"></a><a class="code" href="uart_8c.html#ae2bcbf05a79de1a8a42492a8e5169c22">MAX_PACKETS</a>)</div>
<div class="line">        r = <a name="a18"></a><a class="code" href="group__Utils.html#ga24d7f46816d3af0d591209568477d257">sol_util_uuid_gen</a>(<span class="keyword">true</span>, <span class="keyword">true</span>, &amp;buf);</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        r = <a name="a19"></a><a class="code" href="group__Buffer.html#ga48b9fa527ababb11b0bdc5814927b520">sol_buffer_append_slice</a>(&amp;buf, <a name="a20"></a><a class="code" href="group__Str__Slice.html#ga403d23f24219db595e892573d3384c37">sol_str_slice_from_str</a>(<span class="stringliteral">&quot;close&quot;</span>));</div>
<div class="line">        keep_running = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Could not create the UUID - Reason: %s\n&quot;</span>,</div>
<div class="line">            <a class="code" href="group__Utils.html#gab584188ab3f38605dab8b04aaa85913d">sol_util_strerrora</a>(-r));</div>
<div class="line">        <span class="keywordflow">goto</span> err_exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    v = <a name="a21"></a><a class="code" href="group__Buffer.html#ga75e2a0d3e0c120fe9315e4cdcf6261ab">sol_buffer_steal</a>(&amp;buf, &amp;size);</div>
<div class="line"></div>
<div class="line">    blob = <a name="a22"></a><a class="code" href="group__Types.html#ga42c9abd2ff9950e7ac828c313fb758c9">sol_blob_new</a>(&amp;<a name="a23"></a><a class="code" href="group__Types.html#gafc93597dbfb82dd2b50ce0261d583895">SOL_BLOB_TYPE_DEFAULT</a>, NULL,</div>
<div class="line">        v, size + 1);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!blob) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Could not alloc memory for the blob\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> err_exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Send it</span></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="uart_8c.html#ac7f3be202700792259fedf833dcf695a">send_blob</a>(blob))</div>
<div class="line">        <span class="keywordflow">goto</span> err_exit;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!keep_running)</div>
<div class="line">        <span class="keywordflow">goto</span> exit;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">err_exit:</div>
<div class="line">    <a class="code" href="group__Mainloop.html#ga56c31320e4348c91a719039b5a22dd25">sol_quit</a>();</div>
<div class="line">exit:</div>
<div class="line">    <a class="code" href="uart_8c.html#a2fb0f9e777be7400a884f58fb79ae0ab">producer_timeout</a> = NULL;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> ssize_t</div>
<div class="line"><a name="a24"></a><a class="code" href="uart_8c.html#a1c8a75dae299b5c84afe1f2ec1735aea">consumer_read_available</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="group__UART.html#ga810a1c2f354acba92a33ee97806ad3d1">sol_uart</a> *uart, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structsol__buffer.html">sol_buffer</a> *buf)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsol__str__slice.html">sol_str_slice</a> slice = <a name="a25"></a><a class="code" href="group__Buffer.html#ga8514e78d12dbe8c959af39de05f7c547">sol_buffer_get_slice</a>(buf);</div>
<div class="line">    <span class="keywordtype">char</span> *sep;</div>
<div class="line"></div>
<div class="line">    sep = memchr(slice.<a name="a26"></a><a class="code" href="structsol__str__slice.html#a38ae63b741a375104ae7cc3a5da911a4">data</a>, <span class="charliteral">&#39;\0&#39;</span>, slice.<a name="a27"></a><a class="code" href="structsol__str__slice.html#a9b9f38d8d946af896daf76fab04473b7">len</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!sep)</div>
<div class="line">        <span class="keywordflow">return</span> 0; <span class="comment">//Bytes will not be removed fom the rx buffer</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Close the UART!</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a28"></a><a class="code" href="group__Str__Slice.html#ga0f4d08b88b025e80b53b5a29f6874438">sol_str_slice_str_contains</a>(slice, <span class="stringliteral">&quot;close&quot;</span>)) {</div>
<div class="line">        <a name="a29"></a><a class="code" href="group__UART.html#gae577df6de9ef3e7e055dc1a532365c21">sol_uart_close</a>(uart); <span class="comment">//This is completely safe</span></div>
<div class="line">        <a class="code" href="uart_8c.html#a69f5aa89cdbb8f95230645b8036d609c">consumer</a> = NULL;</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n\n** Consumer **: Received the close command\n\n&quot;</span>);</div>
<div class="line">        <a class="code" href="group__Mainloop.html#ga56c31320e4348c91a719039b5a22dd25">sol_quit</a>();</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n\n** Consumer ** : Received UUID %.*s\n\n&quot;</span>,</div>
<div class="line">            <a class="code" href="group__Str__Slice.html#ga10c9d829c4d0c50467106a14190d7611">SOL_STR_SLICE_PRINT</a>(slice));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> slice.<a class="code" href="structsol__str__slice.html#a9b9f38d8d946af896daf76fab04473b7">len</a>; <span class="comment">//slice.len bytes will be removed from the rx buffer</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="a30"></a><a class="code" href="browse_8c.html#a8f65ca9f5a72be7fe776126fc632f8a9">startup</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a31"></a><a class="code" href="structsol__uart__config.html">sol_uart_config</a> producer_config = {</div>
<div class="line">        <a name="a32"></a><a class="code" href="group__Mainloop.html#ga794a88f51470a85bb21279b32cc570ca">SOL_SET_API_VERSION</a>(.<a name="a33"></a><a class="code" href="structsol__uart__config.html#a6bbd1a72654e6f9cb1a794bea57d6621">api_version</a> = <a name="a34"></a><a class="code" href="sol-uart_8h.html#a6970cba74f97b42be0b6a03c18e0ceab">SOL_UART_CONFIG_API_VERSION</a>, )</div>
<div class="line">        .baud_rate = <a name="a35"></a><a class="code" href="group__UART.html#ggaae564795dd91be6d751299c422725de6a5429907f2937cd9331561f0d3ab22da1">SOL_UART_BAUD_RATE_9600</a>,</div>
<div class="line">        .data_bits = <a name="a36"></a><a class="code" href="group__UART.html#gga97c7889a7f0906d9182d214281e862b2ad8e1ddd48f860005df2b2cd58bcd66d1">SOL_UART_DATA_BITS_8</a>,</div>
<div class="line">        .parity = <a name="a37"></a><a class="code" href="group__UART.html#gga147d7dc05fe10ea3a16db08d1f985db0aa81b3ce41af4f785897021db4e2b6544">SOL_UART_PARITY_NONE</a>,</div>
<div class="line">        .stop_bits = <a name="a38"></a><a class="code" href="group__UART.html#ggab3145a8bc5c31c5e6632b8389b86b2edaf77490a7274ba43bb8adf2e0550baee9">SOL_UART_STOP_BITS_ONE</a>,</div>
<div class="line">        .on_feed_done = <a class="code" href="uart_8c.html#a8694ec865bfd7b8d243ca28de0957684">producer_data_written</a>,</div>
<div class="line">        .feed_size = <a name="a39"></a><a class="code" href="uart_8c.html#a56e69a9cc5c3a49f88fd0214f78f54d6">FEED_SIZE</a> <span class="comment">//Note that feed buffer is limited!</span></div>
<div class="line">    };</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsol__uart__config.html">sol_uart_config</a> consumer_config = {</div>
<div class="line">        <a class="code" href="group__Mainloop.html#ga794a88f51470a85bb21279b32cc570ca">SOL_SET_API_VERSION</a>(.<a class="code" href="structsol__uart__config.html#a6bbd1a72654e6f9cb1a794bea57d6621">api_version</a> = <a class="code" href="sol-uart_8h.html#a6970cba74f97b42be0b6a03c18e0ceab">SOL_UART_CONFIG_API_VERSION</a>, )</div>
<div class="line">        .baud_rate = <a class="code" href="group__UART.html#ggaae564795dd91be6d751299c422725de6a5429907f2937cd9331561f0d3ab22da1">SOL_UART_BAUD_RATE_9600</a>,</div>
<div class="line">        .data_bits = <a class="code" href="group__UART.html#gga97c7889a7f0906d9182d214281e862b2ad8e1ddd48f860005df2b2cd58bcd66d1">SOL_UART_DATA_BITS_8</a>,</div>
<div class="line">        .parity = <a class="code" href="group__UART.html#gga147d7dc05fe10ea3a16db08d1f985db0aa81b3ce41af4f785897021db4e2b6544">SOL_UART_PARITY_NONE</a>,</div>
<div class="line">        .stop_bits = <a class="code" href="group__UART.html#ggab3145a8bc5c31c5e6632b8389b86b2edaf77490a7274ba43bb8adf2e0550baee9">SOL_UART_STOP_BITS_ONE</a>,</div>
<div class="line">        .on_data = <a class="code" href="uart_8c.html#a1c8a75dae299b5c84afe1f2ec1735aea">consumer_read_available</a>,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">char</span> **argv;</div>
<div class="line">    <span class="keywordtype">int</span> argc;</div>
<div class="line"></div>
<div class="line">    argc = <a name="a40"></a><a class="code" href="group__Mainloop.html#ga12cabf4e32145c725bb37bf94515d397">sol_argc</a>();</div>
<div class="line">    argv = <a name="a41"></a><a class="code" href="group__Mainloop.html#ga924fdfbe38b222739c2bc43a63802fac">sol_argv</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 3) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Usage: %s &lt;producerUART&gt; &lt;consumerUART&gt;\n&quot;</span>, argv[0]);</div>
<div class="line">        <span class="keywordflow">goto</span> err_exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="uart_8c.html#a9a72b10cfa6ae68070956e2f3478dc22">producer</a> = <a name="a42"></a><a class="code" href="group__UART.html#ga9ccf851073317c85e4f72ec197ae2556">sol_uart_open</a>(argv[1], &amp;producer_config);</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="uart_8c.html#a9a72b10cfa6ae68070956e2f3478dc22">producer</a>) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Could not create the producer!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> err_exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="uart_8c.html#a69f5aa89cdbb8f95230645b8036d609c">consumer</a> = <a class="code" href="group__UART.html#ga9ccf851073317c85e4f72ec197ae2556">sol_uart_open</a>(argv[2], &amp;consumer_config);</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="uart_8c.html#a69f5aa89cdbb8f95230645b8036d609c">consumer</a>) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Could not create the consumer\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> err_exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//This will produce all the data to be sent</span></div>
<div class="line">    <a class="code" href="uart_8c.html#a2fb0f9e777be7400a884f58fb79ae0ab">producer_timeout</a> = <a name="a43"></a><a class="code" href="group__Mainloop.html#ga9d0cd6af9dab4da3002e5cd596ce604f">sol_timeout_add</a>(10, <a class="code" href="uart_8c.html#af9f6c5e151a851d960a38b4d4b1cb432">producer_make_data</a>, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="uart_8c.html#a2fb0f9e777be7400a884f58fb79ae0ab">producer_timeout</a>) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Could not create the producer timeout!\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> err_exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">err_exit:</div>
<div class="line">    <a class="code" href="group__Mainloop.html#ga56c31320e4348c91a719039b5a22dd25">sol_quit</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="a44"></a><a class="code" href="browse_8c.html#af80085e2fde103b0fcdf58fcab027e47">shutdown</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="uart_8c.html#a9a72b10cfa6ae68070956e2f3478dc22">producer</a>)</div>
<div class="line">        <a class="code" href="group__UART.html#gae577df6de9ef3e7e055dc1a532365c21">sol_uart_close</a>(<a class="code" href="uart_8c.html#a9a72b10cfa6ae68070956e2f3478dc22">producer</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="uart_8c.html#a69f5aa89cdbb8f95230645b8036d609c">consumer</a>)</div>
<div class="line">        <a class="code" href="group__UART.html#gae577df6de9ef3e7e055dc1a532365c21">sol_uart_close</a>(<a class="code" href="uart_8c.html#a69f5aa89cdbb8f95230645b8036d609c">consumer</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="uart_8c.html#a2fb0f9e777be7400a884f58fb79ae0ab">producer_timeout</a>)</div>
<div class="line">        <a name="a45"></a><a class="code" href="group__Mainloop.html#gae1f45ba3de62603e90903d1214cf834f">sol_timeout_del</a>(<a class="code" href="uart_8c.html#a2fb0f9e777be7400a884f58fb79ae0ab">producer_timeout</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (pending_blob)</div>
<div class="line">        <a class="code" href="group__Types.html#gaaf14a0023ae6a06a7e9960e5b622a2ad">sol_blob_unref</a>(pending_blob);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="a46"></a><a class="code" href="group__Mainloop.html#ga54818bc87ca55fe50e3732f52b56e009">SOL_MAIN_DEFAULT</a>(<a class="code" href="browse_8c.html#a8f65ca9f5a72be7fe776126fc632f8a9">startup</a>, <a class="code" href="browse_8c.html#af80085e2fde103b0fcdf58fcab027e47">shutdown</a>);</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<a href="http://solettaproject.github.io/docs/">Full online documentation</a> | 
<a href="index.html">C API Index</a>
</small></address>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
